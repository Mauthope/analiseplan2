<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Média de Tempo por Motivo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div style="text-align: center; margin-bottom: 20px;">
        <h1 id="highlighted">Média de "Rota 1": Calculando...</h1>
    </div>
    <canvas id="myChart" width="400" height="200"></canvas>
    <script>
        const data = [
            { motivo: 'Rota 1', tempo: 10 },
            { motivo: 'Rota 2', tempo: 20 },
            { motivo: 'Rota 1', tempo: 15 },
            { motivo: 'Rota 3', tempo: 30 },
            { motivo: 'Rota 2', tempo: 25 },
            { motivo: 'Rota 4', tempo: 5 },
            { motivo: 'Rota 1', tempo: 20 }
        ];

        // Filtrar e calcular a média para "Rota 1"
        const rota1Data = data.filter(item => item.motivo === 'Rota 1');
        const rota1Media = rota1Data.reduce((sum, item) => sum + item.tempo, 0) / rota1Data.length;

        // Atualizar o texto destacado acima do gráfico
        document.getElementById('highlighted').innerText = `Média de "Rota 1": ${rota1Media.toFixed(2)} minutos`;

        // Filtrar dados excluindo "Rota 1"
        const filteredData = data.filter(item => item.motivo !== 'Rota 1');

        // Agrupar por motivo e calcular a média
        const groupedData = filteredData.reduce((acc, item) => {
            if (!acc[item.motivo]) {
                acc[item.motivo] = { motivo: item.motivo, totalTempo: 0, count: 0 };
            }
            acc[item.motivo].totalTempo += item.tempo;
            acc[item.motivo].count += 1;
            return acc;
        }, {});

        const chartData = Object.values(groupedData).map(group => ({
            motivo: group.motivo,
            media: group.totalTempo / group.count
        }));

        // Ordenar em ordem decrescente da média
        chartData.sort((a, b) => b.media - a.media);

        // Preparar dados para o gráfico
        const labels = chartData.map(item => item.motivo);
        const averages = chartData.map(item => item.media);

        // Criar o gráfico
        const ctx = document.getElementById('myChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Média de Tempo por Motivo',
                    data: averages,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: true
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.raw.toFixed(2)} minutos`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Média de Tempo (minutos)'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Motivos'
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
